---
title: "FPGA中的AXI总线"
date: "2024-04-11" # 格式为 YYYY-MM-DD
categories: LoGi
tags:
  - 外设接口
  - 通信技术
summary: "AXI总线是一种包含地址与数据的架构，而AXI-Stream是VIVADO的ip核常用的简化版本AXI接口"
author: "ChatGPT"
---

# FPGA中的AXI总线
AXI是由ARM公司提出的一种高性能、高带宽的接口规范，它是AMBA（Advanced Microcontroller Bus Architecture）规范的一部分。AMBA规范是为了在微控制单元（MCU）、处理器核心、外设等之间提供一个高效的通信机制。AXI标准支持高频率、大数据宽度的数据传输，旨在提供高效的芯片内通信。

## 引入
AXI类通信协议有5个「通道」Channel，每个通道中有若干的端口负责完成一种任务。

- 写入地址通道
- 数据写入通道
- 读出地址通道
- 数据读出通道
- 读出反馈通道

这使得AXI可以同时读出和写入。

![AXI-Stream Blocking Mode](./picture/blog/DmZi_FPGA中的AXI总线_1.png)

每个通道都是一个类似于SPI的数据传输协议，由如下端口组成

- tvaild
- tdata
- tready
- tlast

## 两种VIVADO中常用的接口

### AXI接口（`s_axi`）

- **全称**：Advanced eXtensible Interface
- **特点**：AXI是一种内存映射通信接口，用于处理器与其外设之间的复杂数据交换。它支持读写操作，允许数据在内存地址之间传输。
- **用途**：主要用于处理器访问内存、寄存器或其他处理器资源，支持突发传输和复杂的数据操作。

### AXI Stream接口（`s_axis`、`m_axis`）

- **全称**：AXI Streaming
- **特点**：AXI Stream专为简化的、高速的、单向的数据流设计。它去除了AXI接口中的地址和控制信号，专注于数据的连续流动。
- **用途**：主要用于点对点的数据流传输场景，如数字信号处理（DSP）操作、视频处理流水线等，其中数据以流的形式顺序处理。

### 区别和应用

- **AXI接口**提供了更为复杂和灵活的数据传输机制，支持高度的互连和多样化的数据交互模式，适合于需要内存访问的场景。
- **AXI Stream接口**则简化了接口协议，专注于高效的数据流传输，适合于数据需要按顺序连续处理的应用场景。



## 数据通道中的信号端口含义
AXI的每个通道都是一个类似于SPI的同步传输时序。

![AXI-Stream Blocking Mode](./picture/blog/DmZi_FPGA中的AXI总线_1.png)

![AXI-Stream Non-Blocking Mode](./picture/blog/DmZi_FPGA中的AXI总线_2.png)

从上图可以看出，突发模式传输信息时，数据的发送方会留意数据接收方给的`TREADY`信号。

**只有在接收方准备完成之后才继续变换下一个数据，否则当前数据将一直保持。**

对比上边两个图片可以发现。

图1的数据可以不重不漏的进入和输出到ip核模块中。

而图2的数据只能保证输入全部有效的情况下输出才会有效，并且丢失了大量数据。

### 主设备和从设备的数据交换

数据仅在`TVALID`和`TREADY`都为高电平时传输。这意味着，只有当发送方准备好发送数据，并且接收方也准备好接收数据时，数据才会在它们之间传输。

在主设备向从设备发送数据的场景中：

- 主设备设置`TVALID`，表示其有有效数据要发送。
- 从设备通过设置`TREADY`来响应，表示它准备好接收数据。

在从设备向主设备发送数据的场景中：

- 从设备设置`TVALID`，表示其有有效数据要发送。
- 主设备通过设置`TREADY`来响应，表示它准备好接收数据。
  
### TLAST信号的作用
此外`tlast`信号会指示数据的末尾，提示数据流已经结束。

- **突发传输结束标志**：`TLAST`在一次突发传输的最后一个数据项上被设置为高电平，用以标示这是当前突发传输的最后一个数据项。这对于接收方来说非常重要，因为它需要知道何时一个突发传输结束，以便正确处理接收到的数据序列。
- **数据帧边界**：在处理流数据时（如视频流、网络包等），`TLAST`也可以用来标示数据帧的边界，确保数据的逻辑分组和完整性。
- **大量数据传输**：当大量数据需要通过AXI总线传输时，`TLAST`帮助接收方识别数据突发的结束，从而正确地将这些数据组织成有意义的信息。
- **流控制**：在数据流应用中（如音频、视频处理），`TLAST`指示流的数据包或帧的结束，有助于同步和流控制。




## 地址映射
### Memory-Mapped概念
“Memory-mapped”一词，是指一种将设备（如外设、寄存器等）的控制接口映射到主存储器地址空间的技术。这样，CPU可以通过读写这些特定的内存地址来控制这些设备，就像访问普通内存一样。这种技术简化了设备控制逻辑，有利于软件的开发和复用。

### 应用场景
“High-performance memory-mapped”接口在多种应用场景下非常重要，尤其是在要求高速数据处理和低延迟访问的系统中，例如高性能计算（HPC）、大规模数据处理、实时系统和先进的嵌入式系统等。

通过AXI4，系统设计者可以实现高效的数据通路和控制路径，以满足现代复杂电子系统对性能和带宽的严苛要求。希望这解释清楚了“high-performance memory-mapped”的含义。


## 突发传输
突发传输（**Burst** Transfer）与普通传输（或称单次传输，Single Transfer）是数据通信领域中两种基本的传输模式，它们在多个方面有着根本的区别。理解这些区别有助于设计更高效的通信协议和系统架构。

### 突发传输

突发传输指的是在单个事务中连续传输多个数据单元的过程。这种模式通常用于高性能数据传输场景，特别是当数据被存储在连续的地址空间时，可以通过少量的控制信号传输大量数据，从而提高数据传输效率和减少通信开销。

**优点**：
- **高效率**：通过减少每次数据交换所需的握手操作，突发传输能显著提高数据传输的效率。
- **高带宽利用率**：连续传输多个数据单元能更好地利用通信链路的带宽，尤其是在数据传输量大的应用场景中。
- **低延迟**：减少了事务开始和结束的次数，有助于降低传输延迟。

**应用场景**：大量数据传输、高性能计算、高速缓存填充等。

### 突发传输的关键参数

1. **起始地址**：指定突发传输的起始位置。
2. **突发长度**（Burst Length）：指定在突发中要传输的数据数量。
3. **突发大小**（Burst Size）：定义每次数据传输的大小（例如，每次传输8位、16位、32位等）。
4. **突发类型**（Burst Type）：指定突发传输的模式，例如固定（FIXED）、递增（INCR）或者包裹（WRAP）。对于连续的地址空间数据传输，通常使用“递增”模式。
5. **传输宽度**：AXI总线的宽度，例如32位、64位等。

### 实施突发传输的步骤

在AXI通信中，发起突发传输涉及到以下步骤：

1. **设置起始地址**：通过AXI总线的地址通道发送突发的起始地址。
2. **配置突发参数**：通过控制通道设置突发长度、突发大小和突发类型等参数。
3. **数据传输**：接着，通过数据通道连续发送或接收数据。根据突发长度和突发大小，总线自动计算后续的地址。
4. **传输结束**：一旦所有数据都被传输，事务完成。

### 普通传输

普通传输（或单次传输）是指每个事务只传输一个数据单元的过程。这种模式简单且适用于数据量较小或传输需求较低的场景。

**优点**：
- **简单性**：控制逻辑简单，易于实现和管理。
- **灵活性**：适用于各种不需要高速连续数据传输的应用，如简单的外设控制。

**缺点**：
- **低效率**：每次传输需要独立的控制信号，当数据量增大时，通信效率较低。
- **低带宽利用率**：较多的控制开销会占用可用的带宽，特别是在需要传输大量数据的应用中。

### 总结

突发传输与普通传输的选择取决于特定应用的需求。对于需要高速、大量数据传输的应用，突发传输提供了高效率和高带宽利用率的优势。而对于数据量较小、传输需求不高的场景，普通传输因其简单和灵活而更为适用。