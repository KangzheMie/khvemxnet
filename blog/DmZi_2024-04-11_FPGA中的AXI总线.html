
<script>
  if (window.location.href.indexOf('?page=DmZi_2024-04-11_FPGA中的AXI总线') === -1) {
    window.location.href = '/index.html?page=./blog/DmZi_2024-04-11_FPGA中的AXI总线.html';
  }
</script>
<h1 id="fpga中的axi总线">FPGA中的AXI总线</h1>
<p>AXI是由ARM公司提出的一种高性能、高带宽的接口规范，它是AMBA（Advanced
Microcontroller Bus
Architecture）规范的一部分。AMBA规范是为了在微控制单元（MCU）、处理器核心、外设等之间提供一个高效的通信机制。AXI标准支持高频率、大数据宽度的数据传输，旨在提供高效的芯片内通信。</p>
<h2 id="引入">引入</h2>
<p>AXI类通信协议有5个「通道」Channel，每个通道中有若干的端口负责完成一种任务。</p>
<ul>
<li><p>写入地址通道</p></li>
<li><p>数据写入通道</p></li>
<li><p>读出地址通道</p></li>
<li><p>数据读出通道</p></li>
<li><p>读出反馈通道</p></li>
</ul>
<p>这使得AXI可以同时读出和写入。</p>
<figure>
<img src="./picture/blog/DmZi_FPGA中的AXI总线_1.png"
alt="AXI-Stream Blocking Mode" />
<figcaption aria-hidden="true">AXI-Stream Blocking Mode</figcaption>
</figure>
<p>每个通道都是一个类似于SPI的数据传输协议，由如下端口组成</p>
<ul>
<li>tvaild</li>
<li>tdata</li>
<li>tready</li>
<li>tlast</li>
</ul>
<h2 id="两种vivado中常用的接口">两种VIVADO中常用的接口</h2>
<h3 id="axi接口s_axi">AXI接口（<code>s_axi</code>）</h3>
<ul>
<li><strong>全称</strong>：Advanced eXtensible Interface</li>
<li><strong>特点</strong>：AXI是一种内存映射通信接口，用于处理器与其外设之间的复杂数据交换。它支持读写操作，允许数据在内存地址之间传输。</li>
<li><strong>用途</strong>：主要用于处理器访问内存、寄存器或其他处理器资源，支持突发传输和复杂的数据操作。</li>
</ul>
<h3 id="axi-stream接口s_axism_axis">AXI
Stream接口（<code>s_axis</code>、<code>m_axis</code>）</h3>
<ul>
<li><strong>全称</strong>：AXI Streaming</li>
<li><strong>特点</strong>：AXI
Stream专为简化的、高速的、单向的数据流设计。它去除了AXI接口中的地址和控制信号，专注于数据的连续流动。</li>
<li><strong>用途</strong>：主要用于点对点的数据流传输场景，如数字信号处理（DSP）操作、视频处理流水线等，其中数据以流的形式顺序处理。</li>
</ul>
<h3 id="区别和应用">区别和应用</h3>
<ul>
<li><strong>AXI接口</strong>提供了更为复杂和灵活的数据传输机制，支持高度的互连和多样化的数据交互模式，适合于需要内存访问的场景。</li>
<li><strong>AXI
Stream接口</strong>则简化了接口协议，专注于高效的数据流传输，适合于数据需要按顺序连续处理的应用场景。</li>
</ul>
<h2 id="数据通道中的信号端口含义">数据通道中的信号端口含义</h2>
<p>AXI的每个通道都是一个类似于SPI的同步传输时序。</p>
<figure>
<img src="./picture/blog/DmZi_FPGA中的AXI总线_1.png"
alt="AXI-Stream Blocking Mode" />
<figcaption aria-hidden="true">AXI-Stream Blocking Mode</figcaption>
</figure>
<figure>
<img src="./picture/blog/DmZi_FPGA中的AXI总线_2.png"
alt="AXI-Stream Non-Blocking Mode" />
<figcaption aria-hidden="true">AXI-Stream Non-Blocking Mode</figcaption>
</figure>
<p>从上图可以看出，突发模式传输信息时，数据的发送方会留意数据接收方给的<code>TREADY</code>信号。</p>
<p><strong>只有在接收方准备完成之后才继续变换下一个数据，否则当前数据将一直保持。</strong></p>
<p>对比上边两个图片可以发现。</p>
<p>图1的数据可以不重不漏的进入和输出到ip核模块中。</p>
<p>而图2的数据只能保证输入全部有效的情况下输出才会有效，并且丢失了大量数据。</p>
<h3 id="主设备和从设备的数据交换">主设备和从设备的数据交换</h3>
<p>数据仅在<code>TVALID</code>和<code>TREADY</code>都为高电平时传输。这意味着，只有当发送方准备好发送数据，并且接收方也准备好接收数据时，数据才会在它们之间传输。</p>
<p>在主设备向从设备发送数据的场景中： -
主设备设置<code>TVALID</code>，表示其有有效数据要发送。 -
从设备通过设置<code>TREADY</code>来响应，表示它准备好接收数据。</p>
<p>在从设备向主设备发送数据的场景中： -
从设备设置<code>TVALID</code>，表示其有有效数据要发送。 -
主设备通过设置<code>TREADY</code>来响应，表示它准备好接收数据。</p>
<h3 id="tlast信号的作用">TLAST信号的作用</h3>
<p>此外<code>tlast</code>信号会指示数据的末尾，提示数据流已经结束。</p>
<ul>
<li><strong>突发传输结束标志</strong>：<code>TLAST</code>在一次突发传输的最后一个数据项上被设置为高电平，用以标示这是当前突发传输的最后一个数据项。这对于接收方来说非常重要，因为它需要知道何时一个突发传输结束，以便正确处理接收到的数据序列。</li>
<li><strong>数据帧边界</strong>：在处理流数据时（如视频流、网络包等），<code>TLAST</code>也可以用来标示数据帧的边界，确保数据的逻辑分组和完整性。</li>
<li><strong>大量数据传输</strong>：当大量数据需要通过AXI总线传输时，<code>TLAST</code>帮助接收方识别数据突发的结束，从而正确地将这些数据组织成有意义的信息。</li>
<li><strong>流控制</strong>：在数据流应用中（如音频、视频处理），<code>TLAST</code>指示流的数据包或帧的结束，有助于同步和流控制。</li>
</ul>
<h2 id="地址映射">地址映射</h2>
<h3 id="memory-mapped概念">Memory-Mapped概念</h3>
<p>“Memory-mapped”一词，是指一种将设备（如外设、寄存器等）的控制接口映射到主存储器地址空间的技术。这样，CPU可以通过读写这些特定的内存地址来控制这些设备，就像访问普通内存一样。这种技术简化了设备控制逻辑，有利于软件的开发和复用。</p>
<h3 id="应用场景">应用场景</h3>
<p>“High-performance
memory-mapped”接口在多种应用场景下非常重要，尤其是在要求高速数据处理和低延迟访问的系统中，例如高性能计算（HPC）、大规模数据处理、实时系统和先进的嵌入式系统等。</p>
<p>通过AXI4，系统设计者可以实现高效的数据通路和控制路径，以满足现代复杂电子系统对性能和带宽的严苛要求。希望这解释清楚了“high-performance
memory-mapped”的含义。</p>
<h2 id="突发传输">突发传输</h2>
<p>突发传输（<strong>Burst</strong>
Transfer）与普通传输（或称单次传输，Single
Transfer）是数据通信领域中两种基本的传输模式，它们在多个方面有着根本的区别。理解这些区别有助于设计更高效的通信协议和系统架构。</p>
<h3 id="突发传输-1">突发传输</h3>
<p>突发传输指的是在单个事务中连续传输多个数据单元的过程。这种模式通常用于高性能数据传输场景，特别是当数据被存储在连续的地址空间时，可以通过少量的控制信号传输大量数据，从而提高数据传输效率和减少通信开销。</p>
<p><strong>优点</strong>： -
<strong>高效率</strong>：通过减少每次数据交换所需的握手操作，突发传输能显著提高数据传输的效率。
-
<strong>高带宽利用率</strong>：连续传输多个数据单元能更好地利用通信链路的带宽，尤其是在数据传输量大的应用场景中。
-
<strong>低延迟</strong>：减少了事务开始和结束的次数，有助于降低传输延迟。</p>
<p><strong>应用场景</strong>：大量数据传输、高性能计算、高速缓存填充等。</p>
<h3 id="突发传输的关键参数">突发传输的关键参数</h3>
<ol type="1">
<li><strong>起始地址</strong>：指定突发传输的起始位置。</li>
<li><strong>突发长度</strong>（Burst
Length）：指定在突发中要传输的数据数量。</li>
<li><strong>突发大小</strong>（Burst
Size）：定义每次数据传输的大小（例如，每次传输8位、16位、32位等）。</li>
<li><strong>突发类型</strong>（Burst
Type）：指定突发传输的模式，例如固定（FIXED）、递增（INCR）或者包裹（WRAP）。对于连续的地址空间数据传输，通常使用“递增”模式。</li>
<li><strong>传输宽度</strong>：AXI总线的宽度，例如32位、64位等。</li>
</ol>
<h3 id="实施突发传输的步骤">实施突发传输的步骤</h3>
<p>在AXI通信中，发起突发传输涉及到以下步骤：</p>
<ol type="1">
<li><strong>设置起始地址</strong>：通过AXI总线的地址通道发送突发的起始地址。</li>
<li><strong>配置突发参数</strong>：通过控制通道设置突发长度、突发大小和突发类型等参数。</li>
<li><strong>数据传输</strong>：接着，通过数据通道连续发送或接收数据。根据突发长度和突发大小，总线自动计算后续的地址。</li>
<li><strong>传输结束</strong>：一旦所有数据都被传输，事务完成。</li>
</ol>
<h3 id="普通传输">普通传输</h3>
<p>普通传输（或单次传输）是指每个事务只传输一个数据单元的过程。这种模式简单且适用于数据量较小或传输需求较低的场景。</p>
<p><strong>优点</strong>： -
<strong>简单性</strong>：控制逻辑简单，易于实现和管理。 -
<strong>灵活性</strong>：适用于各种不需要高速连续数据传输的应用，如简单的外设控制。</p>
<p><strong>缺点</strong>： -
<strong>低效率</strong>：每次传输需要独立的控制信号，当数据量增大时，通信效率较低。
-
<strong>低带宽利用率</strong>：较多的控制开销会占用可用的带宽，特别是在需要传输大量数据的应用中。</p>
<h3 id="总结">总结</h3>
<p>突发传输与普通传输的选择取决于特定应用的需求。对于需要高速、大量数据传输的应用，突发传输提供了高效率和高带宽利用率的优势。而对于数据量较小、传输需求不高的场景，普通传输因其简单和灵活而更为适用。</p>
