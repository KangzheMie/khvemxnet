
<script>
  if (window.location.href.indexOf('?page=RrJm_2024-03-24_MATLAB批量导入csv') === -1) {
    window.location.href = '/index.html?page=./blog/RrJm_2024-03-24_MATLAB批量导入csv.html';
  }
</script>
<h1 id="matlab导入csv">MATLAB导入csv</h1>
<h2 id="指定目录并遍历">指定目录并遍历</h2>
<div class="sourceCode" id="cb1"><pre
class="sourceCode matlab"><code class="sourceCode matlab"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">% 指定文件夹路径</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="va">folderPath</span> <span class="op">=</span> <span class="ss">&#39;./raw&#39;</span><span class="op">;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="va">files</span> <span class="op">=</span> <span class="va">dir</span>(<span class="va">fullfile</span>(<span class="va">folderPath</span><span class="op">,</span> <span class="ss">&#39;*.csv&#39;</span>))<span class="op">;</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">% 遍历文件夹中的每个CSV文件</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="kw">for</span> <span class="va">i</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">length</span>(<span class="va">files</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">% 获取文件的完整路径</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="va">fullPath</span> <span class="op">=</span> <span class="va">fullfile</span>(<span class="va">folderPath</span><span class="op">,</span> <span class="va">files</span>(<span class="va">i</span>).<span class="va">name</span>)<span class="op">;</span></span></code></pre></div>
<h2 id="根据文件名解析需要读出的数据">根据文件名解析需要读出的数据</h2>
<div class="sourceCode" id="cb2"><pre
class="sourceCode matlab"><code class="sourceCode matlab"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">% 解析文件名以获取所需的列号</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">% 假设列号位于文件名的第2个字符，如&#39;A2HC001M300MV.csv&#39;中的&#39;2&#39;</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="va">columnName</span> <span class="op">=</span> <span class="va">files</span>(<span class="va">i</span>).<span class="va">name</span>(<span class="fl">2</span>)<span class="op">;</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">% 将列号字符转换为数值类型</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="va">columnIndex</span> <span class="op">=</span> <span class="va">str2double</span>(<span class="va">columnName</span>) <span class="op">+</span> <span class="fl">3</span><span class="op">;</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">% 使用opts对象指定输入的模式</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="va">opts</span> <span class="op">=</span> <span class="va">detectImportOptions</span>(<span class="va">fullPath</span><span class="op">,</span> <span class="ss">&#39;VariableNamingRule&#39;</span><span class="op">,</span> <span class="ss">&#39;preserve&#39;</span>)<span class="op">;</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="va">opts</span>.<span class="va">SelectedVariableNames</span> <span class="op">=</span> <span class="va">opts</span>.<span class="va">VariableNames</span>(<span class="va">columnIndex</span>)<span class="op">;</span> <span class="co">% 选择指定列</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="va">data</span> <span class="op">=</span> <span class="va">readmatrix</span>(<span class="va">fullPath</span><span class="op">,</span> <span class="va">opts</span>)<span class="op">;</span></span></code></pre></div>
<p>这段代码中的 <code>opts</code> 实际上是一个
<code>import options</code> 对象，它在 MATLAB
中用于定义和存储导入数据时的选项设置。</p>
<h3 id="detectimportoptions函数">detectImportOptions函数</h3>
<p><code>detectImportOptions</code>
函数用于创建一个包含导入数据<strong>所需选项</strong>的对象。</p>
<p>这个函数会自动检测数据源（例如CSV文件）的格式和结构，并据此设置导入选项，以便后续的
<code>readtable</code>、<code>readmatrix</code>
或类似函数<strong>能够按照这些选项正确读取</strong>数据。</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode matlab"><code class="sourceCode matlab"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="va">opts</span> <span class="op">=</span> <span class="va">detectImportOptions</span>(<span class="va">fullPath</span><span class="op">,</span> <span class="ss">&#39;VariableNamingRule&#39;</span><span class="op">,</span> <span class="ss">&#39;preserve&#39;</span>)<span class="op">;</span></span></code></pre></div>
<p>在这里，<code>fullPath</code> 是数据文件的路径。</p>
<p><code>'VariableNamingRule'</code>, <code>'preserve'</code>
参数指示在创建变量名时保持原始列标题的文字，而不是将非字母数字字符转换为下划线（这是
MATLAB
默认的行为）。这样，如果原始数据中的列标题包含特殊字符，这些特殊字符会被保留下来。</p>
<h3
id="opts.selectedvariablenames属性">opts.SelectedVariableNames属性</h3>
<p>opts.SelectedVariableNames属性允许您<strong>指定</strong>在导入数据时希望读取的特定列。这对于只处理文件中某几列数据的情况非常有用，可以提高效率并减少内存使用。</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode matlab"><code class="sourceCode matlab"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="va">opts</span>.<span class="va">SelectedVariableNames</span> <span class="op">=</span> <span class="va">opts</span>.<span class="va">VariableNames</span>(<span class="va">columnIndex</span>)<span class="op">;</span></span></code></pre></div>
<p>这行代码设置了 <code>opts.SelectedVariableNames</code>
属性，使其只包含 <code>opts.VariableNames(columnIndex)</code>
指定的那些列。这里，<code>columnIndex</code>
是一个索引数组，指定了希望从数据源中导入哪些列。通过这种方式，可以只导入感兴趣的数据列，而不是整个数据集。</p>
<h2 id="将读出数据data写入矩阵中">将读出数据data写入矩阵中</h2>
<div class="sourceCode" id="cb5"><pre
class="sourceCode matlab"><code class="sourceCode matlab"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>    <span class="va">data</span> <span class="op">=</span> <span class="va">readmatrix</span>(<span class="va">fullPath</span><span class="op">,</span> <span class="va">opts</span>)<span class="op">;</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">% 将数据存储到以文件名命名的变量中</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">% [路径,名字,后缀] = fileparts(filename)</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    [<span class="op">~,</span> <span class="va">fileName</span><span class="op">,</span> <span class="op">~</span>] <span class="op">=</span> <span class="va">fileparts</span>(<span class="va">files</span>(<span class="va">i</span>).<span class="va">name</span>)<span class="op">;</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">% 注意：MATLAB变量名不能包含特殊字符，如数字和点，因此需要对文件名进行处理</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">% 以下代码将非字母字符替换为下划线，并去掉扩展名</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="va">variableName</span> <span class="op">=</span> <span class="va">regexprep</span>(<span class="va">fileName</span><span class="op">,</span> <span class="ss">&#39;\W|^\d|\..*$&#39;</span><span class="op">,</span> <span class="ss">&#39;_&#39;</span>)<span class="op">;</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">% 将字符串输出到命令台</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    <span class="va">eval</span>([<span class="va">variableName</span> <span class="ss">&#39; = data;&#39;</span>])<span class="op">;</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<h2 id="csv文件和xls文件的区别">csv文件和xls文件的区别</h2>
<p>CSV文件（Comma-Separated
Values，逗号分隔值文件）和Excel文件（如XLS或XLSX格式）是两种常见的数据存储格式，它们在结构、功能和使用场景上有显著的区别。</p>
<h3 id="csv文件">CSV文件</h3>
<div class="sourceCode" id="cb6"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">2045</span><span class="op">,</span><span class="dv">487</span><span class="op">,</span><span class="dv">76</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="op">,</span><span class="dv">1</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">2045</span><span class="op">,</span><span class="dv">487</span><span class="op">,</span><span class="dv">76</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span><span class="op">,</span><span class="dv">2</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">2045</span><span class="op">,</span><span class="dv">487</span><span class="op">,</span><span class="dv">76</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span><span class="op">,</span><span class="dv">3</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">2045</span><span class="op">,</span><span class="dv">487</span><span class="op">,</span><span class="dv">76</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span><span class="op">,</span><span class="dv">4</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">2045</span><span class="op">,</span><span class="dv">487</span><span class="op">,</span><span class="dv">76</span></span></code></pre></div>
<ul>
<li><strong>结构简单</strong>：CSV文件由纯文本组成，使用逗号（或其他分隔符，如制表符）来分隔数据中的每个字段。每行代表一条记录，类似于数据库中的一行。</li>
<li><strong>可读性</strong>：CSV文件可以使用任何文本编辑器打开，内容易于人类阅读和编辑。</li>
<li><strong>兼容性</strong>：几乎所有的编程语言、数据库和电子表格软件都支持CSV格式，使其成为数据交换的通用格式。</li>
<li><strong>限制</strong>：CSV格式缺乏标准化，不同的系统可能使用不同的字符作为字段分隔符。它不支持数据类型定义、多个工作表或富文本格式等复杂功能。</li>
</ul>
<h3 id="excel文件">Excel文件</h3>
<ul>
<li><strong>功能丰富</strong>：Excel文件格式（如XLS或XLSX）支持高级功能，包括单元格格式设置、公式、图表、图像、宏等。</li>
<li><strong>可视化和分析工具</strong>：Excel软件提供了强大的数据分析和可视化工具，使得处理复杂的数据集成为可能。</li>
<li><strong>兼容性</strong>：尽管Excel文件格式主要与Microsoft
Office软件兼容，但许多其他电子表格软件也能够读取和编辑这种格式的文件。</li>
<li><strong>文件大小和性能</strong>：由于额外的功能和格式信息，Excel文件通常比CSV文件大，特别是在处理大量数据时可能会导致性能下降。</li>
</ul>
<h3 id="存储优势">存储优势</h3>
<ul>
<li><strong>CSV</strong>的优势在于其简单性和兼容性，适合于快速交换和存储大量的纯数据。</li>
<li><strong>Excel</strong>的优势在于其功能的丰富性，适合于需要复杂数据分析、格式化显示和报告生成的场景。</li>
</ul>
<h3 id="将csv视作txt文件">将CSV视作TXT文件</h3>
<p>CSV文件实质上是一种特定格式的文本文件，因此可以将其视为TXT文件。实际上，您可以使用文本编辑器（如Notepad）打开CSV文件，也可以将TXT文件重命名为CSV（如果内容符合CSV格式）。然而，将文件视为CSV意味着您认为文件中的数据是以逗号（或其他分隔符）分隔的，适用于表示表格数据。</p>
<p>总之，CSV和Excel文件各有优势，选择哪种格式取决于您的具体需求，如数据的复杂性、是否需要格式化或公式支持、以及与其他系统的兼容性需求。</p>
