
<script>
  if (window.location.href.indexOf('?page=RrJm_2024-04-05_Vivado综合实现电路实例') === -1) {
    window.location.href = '/index.html?page=./blog/RrJm_2024-04-05_Vivado综合实现电路实例.html';
  }
</script>
<h1 id="vivado综合实现电路实例">Vivado综合实现电路实例</h1>
<h2 id="rtl-analysis">RTL Analysis</h2>
<p>拿一个2输入的与门做例子</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode verilog"><code class="sourceCode verilog"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">assign</span> Z <span class="op">=</span> X <span class="op">&amp;</span> Y<span class="op">;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>set_property <span class="op">-</span>dict <span class="op">{</span>PACKAGE_PIN F24  IOSTANDARD LVCMOS18<span class="op">}</span> <span class="op">[</span>get_ports X<span class="op">]</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>set_property <span class="op">-</span>dict <span class="op">{</span>PACKAGE_PIN AF24 IOSTANDARD LVCMOS18<span class="op">}</span> <span class="op">[</span>get_ports Y<span class="op">]</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>set_property <span class="op">-</span>dict <span class="op">{</span>PACKAGE_PIN L21  IOSTANDARD LVCMOS18<span class="op">}</span> <span class="op">[</span>get_ports Z<span class="op">]</span></span></code></pre></div>
<figure>
<img src="./picture/blog/RrJm_Vivado综合实现电路实例_RTL.png"
alt="RTL分析得到的电路" />
<figcaption aria-hidden="true">RTL分析得到的电路</figcaption>
</figure>
<h2 id="synthesis">Synthesis</h2>
<p>经过综合之后，按照上述的RTL逻辑所需，并且结合目前工程的芯片情况，会生成一份「网表(Netlist)文件」。</p>
<p>这一份文件描述的是，完成RTL逻辑需要哪些具体的叶单元(Leaf
Cell)和连线(Net)。</p>
<figure>
<img src="./picture/blog/RrJm_Vivado综合实现电路实例_synthesis.png"
alt="综合网表得到的电路" />
<figcaption aria-hidden="true">综合网表得到的电路</figcaption>
</figure>
<p>如上图所示的是，完成一个与门，需要使用：</p>
<ul>
<li>2个 IBUF 输入缓冲器</li>
<li>1个 OBUF 输出缓冲器</li>
<li>1个 LUT 查找表</li>
</ul>
<p>有了这些树的枝叶和连线的信息，他们就可以完整的描述一个逻辑电路的「拓扑关系」。</p>
<p>理想情况下，只要满足这样拓扑的电路都可以实现RTL的逻辑需求。</p>
<h3 id="网表文件长什么样">网表文件长什么样</h3>
<p>File -&gt; Export -&gt; Export Netlist</p>
<p>EDIF (Electronic Design Interchange Format)是一种基于 S
表达式的供应商中立格式，用于存储电子网表和原理图。这是为电子设计自动化
(EDA)
行业建立中立数据交换格式的首批尝试之一。目标是建立一种通用格式，从中可以派生出
EDA 系统的专有格式。</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode verilog"><code class="sourceCode verilog"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="op">(</span>edif demo</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="op">(</span>edifversion <span class="dv">2</span> <span class="dv">0</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="op">(</span>edifLevel <span class="dv">0</span><span class="op">)</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="op">(</span>keywordmap <span class="op">(</span>keywordlevel <span class="dv">0</span><span class="op">))</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="op">(</span>status</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a> <span class="op">(</span>written</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="op">(</span>timeStamp <span class="dv">2024</span> <span class="dv">04</span> <span class="dv">05</span> <span class="dv">20</span> <span class="dv">47</span> <span class="dv">35</span><span class="op">)</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="op">(</span>program <span class="st">&quot;Vivado&quot;</span> <span class="op">(</span>version <span class="st">&quot;2019.2&quot;</span><span class="op">))</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="op">(</span>comment <span class="st">&quot;Built on &#39;Wed Nov  6 21:40:23 MST 2019&#39;&quot;</span><span class="op">)</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="op">(</span>comment <span class="st">&quot;Built by &#39;xbuild&#39;&quot;</span><span class="op">)</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a> <span class="op">)</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="op">)</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="op">(</span>Library hdi_primitives</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">(</span>edifLevel <span class="dv">0</span><span class="op">)</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">(</span>technology <span class="op">(</span>numberDefinition <span class="op">))</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>   <span class="op">(</span><span class="kw">cell</span> IBUF <span class="op">(</span>celltype GENERIC<span class="op">)</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>     <span class="op">(</span>view netlist <span class="op">(</span>viewtype NETLIST<span class="op">)</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>       <span class="op">(</span>interface </span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>        <span class="op">(</span>port O <span class="op">(</span>direction OUTPUT<span class="op">))</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>        <span class="op">(</span>port I <span class="op">(</span>direction INPUT<span class="op">))</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>       <span class="op">)</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>     <span class="op">)</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>   <span class="op">)</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>   ...</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>   <span class="op">(</span>Library work</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>    <span class="op">(</span>edifLevel <span class="dv">0</span><span class="op">)</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>    <span class="op">(</span>technology <span class="op">(</span>numberDefinition <span class="op">))</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>   <span class="op">(</span><span class="kw">cell</span> demo <span class="op">(</span>celltype GENERIC<span class="op">)</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>     <span class="op">(</span>view demo <span class="op">(</span>viewtype NETLIST<span class="op">)</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>       <span class="op">(</span>interface </span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>        <span class="op">(</span>port X <span class="op">(</span>direction INPUT<span class="op">))</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>        <span class="op">(</span>port Y <span class="op">(</span>direction INPUT<span class="op">))</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>        <span class="op">(</span>port Z <span class="op">(</span>direction OUTPUT<span class="op">))</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>       <span class="op">)</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>       <span class="op">(</span>contents</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>         <span class="op">(</span><span class="kw">instance</span> X_IBUF_inst <span class="op">(</span>viewref netlist <span class="op">(</span>cellref IBUF <span class="op">(</span>libraryref hdi_primitives<span class="op">))))</span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>         <span class="op">(</span><span class="kw">instance</span> Y_IBUF_inst <span class="op">(</span>viewref netlist <span class="op">(</span>cellref IBUF <span class="op">(</span>libraryref hdi_primitives<span class="op">))))</span></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>         <span class="op">(</span><span class="kw">instance</span> Z_OBUF_inst <span class="op">(</span>viewref netlist <span class="op">(</span>cellref OBUF <span class="op">(</span>libraryref hdi_primitives<span class="op">))))</span></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>         <span class="op">(</span><span class="kw">instance</span> Z_OBUF_inst_i_1 <span class="op">(</span>viewref netlist <span class="op">(</span>cellref LUT2 <span class="op">(</span>libraryref hdi_primitives<span class="op">)))</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>           <span class="op">(</span>property INIT <span class="op">(</span>string <span class="st">&quot;4&#39;h8&quot;</span><span class="op">))</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>         <span class="op">)</span></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>         <span class="op">(</span>net X <span class="op">(</span>joined</span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>          <span class="op">(</span>portref I <span class="op">(</span>instanceref X_IBUF_inst<span class="op">))</span></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>          <span class="op">(</span>portref X<span class="op">)</span></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>          <span class="op">)</span></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>           <span class="op">(</span>property IOSTANDARD <span class="op">(</span>string <span class="st">&quot;LVCMOS18&quot;</span><span class="op">))</span></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>         <span class="op">)</span></span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>    ...</span></code></pre></div>
<p>verilog 版本：</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode verilog"><code class="sourceCode verilog"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="dt">input</span> X<span class="op">;</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="dt">input</span> Y<span class="op">;</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="dt">output</span> Z<span class="op">;</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="dt">wire</span> X<span class="op">;</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="dt">wire</span> X_IBUF<span class="op">;</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="dt">wire</span> Y<span class="op">;</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="dt">wire</span> Y_IBUF<span class="op">;</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="dt">wire</span> Z<span class="op">;</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="dt">wire</span> Z_OBUF<span class="op">;</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>IBUF X_IBUF_inst</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>      <span class="op">(</span>.I<span class="op">(</span>X<span class="op">),</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>      .O<span class="op">(</span>X_IBUF<span class="op">));</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>IBUF Y_IBUF_inst</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>      <span class="op">(</span>.I<span class="op">(</span>Y<span class="op">),</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>      .O<span class="op">(</span>Y_IBUF<span class="op">));</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>OBUF Z_OBUF_inst</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>      <span class="op">(</span>.I<span class="op">(</span>Z_OBUF<span class="op">),</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>      .O<span class="op">(</span>Z<span class="op">));</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>LUT2 #<span class="op">(</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>  .INIT<span class="op">(</span><span class="bn">4&#39;h8</span><span class="op">))</span> </span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  Z_OBUF_inst_i_1</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>      <span class="op">(</span>.I0<span class="op">(</span>X_IBUF<span class="op">),</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>      .I1<span class="op">(</span>Y_IBUF<span class="op">),</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>      .O<span class="op">(</span>Z_OBUF<span class="op">));</span></span></code></pre></div>
<h2 id="implementation">Implementation</h2>
<p>网表文件的格式只约束了各个逻辑单元Cell的拓扑关系，没有在空间时间上具有约束。</p>
<p>空间上，芯片内部的连线资源各不相同，并且需要满足IO引脚的空间约束。</p>
<p>时间上，连线需要满足各种时序尽可能延迟短并且同时，并且需要满足用户定义的各种时序约束。</p>
<p>本工程中没有多余的约束，所以系统会按照最短延迟来布线。</p>
<figure>
<img
src="./picture/blog/RrJm_Vivado综合实现电路实例_Implementation1.png"
alt="布线整体视图" />
<figcaption aria-hidden="true">布线整体视图</figcaption>
</figure>
<p>下图展示了抽象的LUT</p>
<figure>
<img
src="./picture/blog/RrJm_Vivado综合实现电路实例_Implementation2.png"
alt="LUT" />
<figcaption aria-hidden="true">LUT</figcaption>
</figure>
<p>下图展示了比较具体的LUT附近的连线过程</p>
<figure>
<img
src="./picture/blog/RrJm_Vivado综合实现电路实例_Implementation3.png"
alt="具体的LUT附近的连线过程" />
<figcaption aria-hidden="true">具体的LUT附近的连线过程</figcaption>
</figure>
<p>从上图的展示可以发现，连线是一个复杂的过程。从IO到所指定的查找表并不是直接连线，而是经过了多层的路由转接。</p>
<h3 id="探究逻辑单元和连线单元的样子">探究逻辑单元和连线单元的样子</h3>
<figure>
<img
src="./picture/blog/RrJm_Vivado综合实现电路实例_Implementation4.png"
alt="连线单元和逻辑单元" />
<figcaption aria-hidden="true">连线单元和逻辑单元</figcaption>
</figure>
<p>从上图可以看出来两个主要的结构：一是负责桥接连线的单元，二是负责逻辑处理的单元。</p>
<p>他们大概每四个一组</p>
<figure>
<img
src="./picture/blog/RrJm_Vivado综合实现电路实例_Implementation5.png"
alt="连线单元和逻辑单元" />
<figcaption aria-hidden="true">连线单元和逻辑单元</figcaption>
</figure>
<figure>
<img
src="./picture/blog/RrJm_Vivado综合实现电路实例_Implementation6.png"
alt="连线单元和逻辑单元" />
<figcaption aria-hidden="true">连线单元和逻辑单元</figcaption>
</figure>
