
<script>
  if (window.location.href.indexOf('?page=DmZi_2024-04-28_LTSpice导入用户元件') === -1) {
    window.location.href = '/index.html?page=./blog/DmZi_2024-04-28_LTSpice导入用户元件.html';
  }
</script>
<h1 id="ltspice导入用户元件">LTSpice导入用户元件</h1>
<p>LTSpice导入电路元件模型以Spice文件为基础。</p>
<h2 id="spice文件">Spice文件</h2>
<h3 id="spice文件的组成">Spice文件的组成</h3>
<p>对于一个复杂的自定义电路模块，是以.subckt开头的，意思是子电路（sub-circuit）。例如在in和out节点之间定义一个RC并联电路。</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode verilog"><code class="sourceCode verilog"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>.subckt myamplifier in out</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>R1 in out <span class="dv">1</span>k</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>C1 in out <span class="dv">10</span>u</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>.ends</span></code></pre></div>
<p>此外还可以给特定类型的元件，比如二极管，赋予物理参数来定义用户模型。使用.model命令，例如定义用户特定参数的PNP二极管。</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode verilog"><code class="sourceCode verilog"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>.model Mypnp PNP <span class="op">(</span>Is<span class="op">=</span><span class="fl">6.734</span>f Xti<span class="op">=</span><span class="dv">3</span> Eg<span class="op">=</span><span class="fl">1.11</span> </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> Vaf<span class="op">=</span><span class="fl">74.03</span> Bf<span class="op">=</span><span class="fl">416.4</span> Ne<span class="op">=</span><span class="fl">1.259</span> Ise<span class="op">=</span><span class="fl">6.734</span>f </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> Ikf<span class="op">=</span><span class="fl">66.78</span>m Xtb<span class="op">=</span><span class="fl">1.5</span> Br<span class="op">=</span><span class="fl">10.61</span> Nc<span class="op">=</span><span class="dv">2</span> Isc<span class="op">=</span><span class="dv">0</span><span class="op">)</span></span></code></pre></div>
<h3 id="lm358-spice文件解析">LM358 Spice文件解析</h3>
<div class="sourceCode" id="cb3"><pre
class="sourceCode verilog"><code class="sourceCode verilog"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>.subckt LMX58_LM2904 IN<span class="op">+</span> IN<span class="op">-</span> VCC VEE OUT</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>******************************************************</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>* MODEL DEFINITIONS<span class="op">:</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>.model BB_SW VSWITCH<span class="op">(</span>Ron<span class="op">=</span><span class="dv">50</span> Roff<span class="op">=</span><span class="fl">1e12</span> Von<span class="op">=</span><span class="fl">700e-3</span> Voff<span class="op">=</span><span class="dv">0</span><span class="op">)</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>.model ESD_SW VSWITCH<span class="op">(</span>Ron<span class="op">=</span><span class="dv">50</span> Roff<span class="op">=</span><span class="fl">1e12</span> Von<span class="op">=</span><span class="fl">250e-3</span> Voff<span class="op">=</span><span class="dv">0</span><span class="op">)</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>.model OL_SW VSWITCH<span class="op">(</span>Ron<span class="op">=</span><span class="fl">1e-3</span> Roff<span class="op">=</span><span class="fl">1e9</span> Von<span class="op">=</span><span class="fl">900e-3</span> Voff<span class="op">=</span><span class="fl">800e-3</span><span class="op">)</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>.model OR_SW VSWITCH<span class="op">(</span>Ron<span class="op">=</span><span class="fl">10e-3</span> Roff<span class="op">=</span><span class="fl">1e9</span> Von<span class="op">=</span><span class="fl">1e-3</span> Voff<span class="op">=</span><span class="dv">0</span><span class="op">)</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>.model R_NOISELESS RES<span class="op">(</span>T_ABS<span class="op">=-</span><span class="fl">273.15</span><span class="op">)</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>******************************************************</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>I_OS        ESDn MID <span class="op">-</span><span class="dv">18</span>N</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>I_B         <span class="dv">37</span> MID <span class="op">-</span><span class="dv">20</span>N</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>V_GRp       <span class="dv">57</span> MID <span class="dv">180</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>V_GRn       <span class="dv">58</span> MID <span class="op">-</span><span class="dv">180</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>V_ISCp      <span class="dv">51</span> MID <span class="dv">40</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>.........</span></code></pre></div>
<p>首先声明了对外的接口</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode verilog"><code class="sourceCode verilog"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>.subckt LMX58_LM2904 IN<span class="op">+</span> IN<span class="op">-</span> VCC VEE OUT</span></code></pre></div>
<p>然后为自己的模型定制特定参数的模型，比如定义了一个R_NOISELESS电阻，他具有参数T_ABS=-273.15。</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode verilog"><code class="sourceCode verilog"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>.model R_NOISELESS RES<span class="op">(</span>T_ABS<span class="op">=-</span><span class="fl">273.15</span><span class="op">)</span></span></code></pre></div>
<p>之后开始对各种器件连线</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode verilog"><code class="sourceCode verilog"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="op">[</span>元件_名<span class="op">]</span> <span class="op">[</span>节点1<span class="op">]</span> <span class="op">[</span>节点2<span class="op">]</span> ... <span class="op">[</span>值<span class="op">]</span></span></code></pre></div>
<h2 id="spice文件的导入">Spice文件的导入</h2>
<h3 id="从外界导入">从外界导入</h3>
<p>在LTSpice中使用如下的spice命令可以把外部的文件导入到工程之中</p>
<p>在Edit &gt; SPICE Directive中</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode verilog"><code class="sourceCode verilog"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>.lib <span class="st">&quot;standard.mos&quot;</span>  <span class="op">;</span> 导入标准MOSFET模型库</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>.include <span class="st">&quot;mycircuit.cir&quot;</span>  <span class="op">;</span> 引入包含整个电路的SPICE文件</span></code></pre></div>
<p>命令之后的路径可以使用相对路径，所以外部的文件可以直接存储在电路仿真工程的文件下。</p>
<h3 id="内嵌到文件中">内嵌到文件中</h3>
<p>使用Edit &gt; SPICE Directive，
然后把spice文本写入到其中。此时LTSpice的这个工程就可以直接通过使用<code>ModuleName</code>的元件来使用spice模型。
<img src="./picture/blog/DmZi_LTSpice元件内嵌.png"
alt="LTSpice元件内嵌" /></p>
<h3 id="自动生成器件符号">自动生成器件符号</h3>
<p>把导入的文件在LTSpice中打开，然后在对外接口的文本位置右键，即可发现自动生成器件符号的选项。</p>
<h3 id="关联已有器件符号">关联已有器件符号</h3>
<p>比如一个三极管模型NPN，可以把三极管的名字更改为用户导入模型中的<code>ModuleName</code>，LTSpice会自动关联三极管模型和导入的Spice模型。</p>
<h3 id="对于来自不同厂商的模型的处理">对于来自不同厂商的模型的处理</h3>
<p>不同厂商的库，实际上内部的基本语法都是spice，而对外的接口被各自改造了。</p>
<p>LTspice的对外接口模式为</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode verilog"><code class="sourceCode verilog"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>.subckt ModuleName Prot1 Prot2</span></code></pre></div>
<p>或者</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode verilog"><code class="sourceCode verilog"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>.model ModuleName ModelName<span class="op">(</span>params<span class="op">)</span></span></code></pre></div>
<p>实际上只需要把别的厂商的库中的接口改成LTSpice的标准即可。</p>
